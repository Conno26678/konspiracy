<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Teacher Panel</title>
</head>

<body>
    <h1>Welcome Teacher</h1>

    <form id="quiz-form" method="POST" action="/teacher">
        <label for="subject">Choose a quiz:</label>
        <select id="subject" name="selectedQuiz"></select>
        <button type="button" id="view-quiz">View Quiz</button>
        <div id="time"></div>
        <button style="display:none;" type="button" onclick="countdown()" id="ready-button">Ready</button>
    </form>

    <div id="quiz-container" style="display:none;">
        <h2 id="quiz-title"></h2>
        <div id="questions"></div>
    </div>

    <script>
        // Injected from server
        const quizzes = <%- JSON.stringify(quizzes) %>;

        const subjectDropdown = document.getElementById('subject');
        const quizContainer = document.getElementById('quiz-container');
        const quizTitle = document.getElementById('quiz-title');
        const questionsDiv = document.getElementById('questions');
        const viewQuizButton = document.getElementById('view-quiz');

        // Populate dropdown
        Object.keys(quizzes).forEach(name => {
            const opt = document.createElement('option');
            opt.value = name;
            opt.textContent = quizzes[name].title || name;
            subjectDropdown.appendChild(opt);
        });

        viewQuizButton.addEventListener('click', () => {
            const selected = subjectDropdown.value;
            questionsDiv.innerHTML = '';
            const quiz = quizzes[selected];
            if (!quiz) return;

            quizTitle.textContent = quiz.title;
            quiz.questions.forEach((qText, idx) => {
                const p = document.createElement('p');
                p.textContent = (idx + 1) + '. ' + qText;
                questionsDiv.appendChild(p);

                const ansObj = quiz.answers[idx];
                Object.entries(ansObj).forEach(([answerText, isCorrect]) => {
                    const div = document.createElement('div');
                    div.innerHTML = `
                        <label>
                            <input type="radio" name="q${idx}" value="${answerText}" disabled>
                            ${answerText}
                        </label>
                    `;
                    questionsDiv.appendChild(div);
                });
            });
            quizContainer.style.display = 'block';
            document.getElementById('ready-button').style.display = 'inline-block';
        });

        function countdown() {
            let t = 5;
            const timeDiv = document.getElementById('time');
            const intId = setInterval(() => {
                timeDiv.textContent = t;
                t--;
                if (t < 0) {
                    clearInterval(intId);
                    document.getElementById('quiz-form').submit();
                }
            }, 1000);
        }
    </script>
</body>

</html>